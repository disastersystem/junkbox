<!doctype html>
<html lang="en">
	<head>
		<title></title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- styles -->
		<link rel="stylesheet" type="text/css" href="css/css.css">
	</head>
	<body>
		<div id="app" class="container">
			<svg id="board" width="560" height="560" preserveAspectRatio="xMidYMin"></svg>
		</div>

		<script src="chess.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.5.3/svg.js"></script>
		<script src="svg.draggable.js"></script>
		<script src="functions.js"></script>
		<!-- <script type="module" src="test.js"></script> -->

		<script>
			var game = new Chess('rnbqkbr1/ppp1pp1p/5n2/2Bp2p1/2P5/3P1N2/PP2PPPP/RN1QKB1R b KQq - 5 5')
			var board = SVG.get('board')

			var squares = []
			var pieces = []

			// const COLUMNS = 'abcdefgh'.split('')
			// const ROWS = '87654321'.split('')
		    
		    function drawBoard() {
		    	const chars = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h']
				const nums = [8, 7, 6, 5, 4, 3, 2, 1]

		    	for (var row = 0; row < 8; row++) {
			        for (var column = 0; column < 8; column++) {
			            /* odd suare gets a light colour, even gets dark */
			            if (row % 2 == 0)
			                var colour = (column % 2 == 0) ?  '#F0D9B5' : '#B58863'
			            else
			                var colour = (column % 2 == 0) ? '#B58863' : '#F0D9B5'
			            
			            /* draw the square */
			            var square = board.rect(70, 70).move(column * 70, row * 70).attr({
			                fill: colour,
			                id: chars[column] + nums[row]
			            })

			            squares.push(square)
			        }
			    }
		    }
		    
		    drawBoard()
		    
		    // function movePieceOnBoard() {}

		    function setPosition(fen) {
		    	var pos = fenToObj(fen)

			    for (var key in pos) {
			        if (pos.hasOwnProperty(key)) { //make sure that the key you get is an actual property of an object, and doesn't come from the prototype.
			            var p = SVG.get(key).bbox()
			            var path = 'pieces/' + pos[key] + '.svg'

			            var piece = board.image(path, 60, 60)
			                .move(p.cx - 30, p.cy - 30)
			                .attr({ id: pos[key], class: 'piece'})

						// paste draggable code here

						// pieces.push(piece)
			        }
			    }

			    return pos
		    }
		    var currPos = setPosition('rnbqkbr1/ppp1pp1p/5n2/2Bp2p1/2P5/3P1N2/PP2PPPP/RN1QKB1R b KQq - 5 5')
		    // the possible moves it current position
		    var wMoves = game.moves()
		    // make a move
		    game.move('Bd7')
		    // new possible moves
		    var bMoves = game.moves()
		    // update the visual board
		    var currPos = setPosition('rn1qkbr1/pppbpp1p/5n2/2Bp2p1/2P5/3P1N2/PP2PPPP/RN1QKB1R w KQq - 6 6') // game.fen()

		    // merge 
		    var legalMoves = [...bMoves, ...wMoves]			
		    
		    // get a object of 
		    var counts = occurences(legalMoves)

		    console.log(counts)

		    // loop through all properties in the object
		    Object.entries(counts).forEach(([key, value]) => {
		    	squares.forEach(square => {
		    		// if the svg square id and the 
		    		if (key == square.node.id) {
		    			square.attr({ 
		    				fill: '#97E1FF',
		    				opacity: 1 - (value / 10)
		    			})
		    		}
		    	})
			})
		</script>
	</body>
</html>